## 7.1 상속 관계 매핑

관계형 데이터베이스에는 객체지향 언어에서 다루는 상속이라는 개념이 없다. ORM에서 이야기하는 상속 관계 매핑은 객체의 상속 구조와 데이터베이스의 Super-Type Sub-Type Relationship을 매핑하는 것이다.
> **Super-Type Sub-Type Relationship**<br>
> 모든 Sub-Type으로 상속되는 공통 속성을 갖고 있는 엔티티가 Super-Type이고,
다른 엔티티와 차이가 있는 고유 속성을 갖고 있는 엔티티는 Sub-Type으로 구분한다.
> 예시는 [https://dataprofessional.tistory.com/86](https://dataprofessional.tistory.com/86)를 참고하면 이해하기 쉬울 것 같다.

### Super-Type Sub-Type Relationship을 물리 모델로 구현하는 방법
1,2,3번 모두 객체는 똑같이 만들 수 있지만, 붙이는 어노테이션을 다르게 설정하여 실제 테이블 생성 전략은 다르게 설정한다.

#### 1. 각각의 테이블로 변환
> 슈퍼타입과 서브타입 각각을 모두 테이블로 만들고 조회할 때 조인을 사용하는 **조인 전략**을 사용한다.

엔티티 각각을 모두 테이블로 만들고 자식 테이블이 부모 테이블의 기본 키를 받아서 PK + FK(식별관계)로 사용하는 전략이다. 
상속 매핑을 사용하기 위해서는 부모 테이블에 `@Inheritance(strategy = InheritanceType.JOINED)`를 붙여야만 한다.

JPA 표준 명세는 구분 칼럼을 사용하도록 하여 책에서는 DTYPE 사용을 에제로 들고 있다. 
부모 테이블에 DTYPE 칼럼을 만들어 연관된 자식 테이블의 타입이 어떤 것인지 저장하는 방법인데, 
DTYPE을 사용하지 않아도 조인하면 값을 들고 올 수 있기 때문에 필수값은 아니지만, 
어떤 타입의 엔티티인지 명시할 수 있으며, SQL에서 사용할 수 있다는 장점이 있어 권장하는 것 같다.
하지만, 하이버네이트를 포함한 몇몇 구현체는 구분 칼럼 없이도 동작한다.

+ 장점
  + 테이블이 정규화된다.
  + 외래 키 참조 무결성 제약조건을 활용할 수 있다.
  + 저장공간을 효율적으로 사용한다.
+ 단점
  + 조회할 때 조인이 많이 사용되므로 성능이 저하될 수 있다.
  + 조회 쿼리가 복잡하다.
  + 데이터를 등록할 INSERT SQL을 두 번 실행해야 한다.

#### 2. 통합 테이블로 변환
> 하나의 테이블에 모든 속성을 넣는 **단일 테이블 전략**을 사용한다.

조회할 때 조인을 사용하지 않아 일반적으로 가장 빠른 전략이며, 하나의 테이블에 모든 속성이 들어있기 때문에 구분 칼럼을 꼭 사용해야 한다.
`@Inheritance(strategy = InheritanceType.SIGLE_TABLE)`을 붙여 단일 테이블 전략임을 알린다.

이 전략을 사용할 때 주의점은 자식 엔티티가 매핑한 칼럼은 모두 null을 허용해야 한다는 점이다.

+ 장점
  + 조인이 없어 일반적으로 조회 성능이 빠르다.
  + 조회 쿼리가 단순하다.
+ 단점
  + 자식 엔티티가 매핑한 컬럼은 모두 null을 허용해야 한다.
  + 단일 테이블에 모든 것을 저장하므로 테이블이 커질 수 있다. 상황에 따라 조회 성능이 오히려 느릴 수도 있다.

#### 3. 서브타입 테이블로 변환
> 슈퍼타입 없이 각각의 서브타입마다 하나의 테이블을 만드는 **구현 클래스마다 테이블 전략**을 사용한다.

`@Inheritance(strategy = InheritanceType.TABLE_PER_CLASS)`를 붙여 구현 클래스마다 테이블 전략임을 알린다.
이 전략은 자식 엔티티마다 테이블을 만드는 전략으로서, 구분 칼럼을 사용하지 않는다. 일반적으로 추천하지 않는 방법이라고 한다.

+ 장점
  + 서브 타입을 구분해서 처리할 때 효과적이다.
  + not null 제약 조건을 사용할 수 있다.
+ 단점
  + SQL에 UNION 키워드를 사용하여 여러 자식 테이블을 함께 조회할 때 성능이 느리다.
  + 자식 테이블을 통합해서 쿼리하기 어렵다.


### 참고
+ [https://dataprofessional.tistory.com/86](https://dataprofessional.tistory.com/86)