## Proxy 객체

프록시 객체란, 엔티티 클래스를 상속받아서 만들어진 객체로서, 실제 엔티티의 참조를 보관하고 있다.

지연로딩 기능을 사용하기 위해 실제 엔티티 대신 데이터베이스 조회를 지연할 수 있는 가짜 객체를 프록시 객체라고 한다.

EntityManager.find()가 아니라 EntityManager.getReference()를 사용하여 엔티티를 실제 사용하는 시점까지 데이터베이스 조회를 미룬다.

프록시 객체는 실제 엔티티 클래스와 겉 모양이 같기 때문에 사용할 때는 실제 엔티티 객체인지 프록시 객체인지 고민하지 않고 사용할 수 있다.

<br>

### 지연로딩(fecth = FetchType.LAZY)

엔티티의 메소드를 호출하면, `프록시의 메소드 -> 영속성 컨텍스트 -> DB 조회 -> 엔티티 생성(참조 보관) -> 엔티티의 메소드` 순으로 진행된다.

```
Member member = getMember(); //join없이 Member 객체만을 가져온다.
Team team = member.getTeam();

team.getName(); //실제 team 객체를 사용하는 시점에 초기화(DB 조회)한다.
```

### 즉시로딩(fetch = FetchType.EAGER)

조인을 사용하여 한 번에 조회하기 때문에, 프록시를 거치지 않고 실제 엔티티를 사용한다.

```
Member member = getMember(); // Team 엔티티도 한번에 조회한다.
```

<br>

### 프록시 초기화

실제 엔티티가 영속성 컨텍스트에 생성되어 있지 않을 때, DB를 조회하여 엔티티 객체를 생성하고, 프록시 객체의 참조 변수에 할당하는 과정을 말한다.

처음 사용할 때 한 번만 초기화되며, 프록시 객체가 엔티티 객체로 바뀌는 것이 아니라 프록시 객체를 통해서 엔티티에 접근하게 된다.

영속성 컨텍스트에 찾는 엔티티가 이미 있으면 데이터베이스를 조회할 필요가 없으므로, em.getReference()를 호출해도 실제 엔티티를 반환한다.